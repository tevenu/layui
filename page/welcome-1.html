<style>
    .welcome .layui-card {
        border: 1px solid #f2f2f2;
        border-radius: 5px;
    }

    .welcome .new-card {
        border: 1px solid #f2f2f2;
        border-radius: 5px;
        height: 440px
    }

    .welcome .icon {
        margin-right: 10px;
        color: #1aa094;
    }

    .welcome .icon-cray {
        color: #ffb800 !important;
    }

    .welcome .icon-blue {
        color: #1e9fff !important;
    }

    .welcome .icon-tip {
        color: #ff5722 !important;
    }

    .welcome .layuimini-qiuck-module {
        text-align: center;
        margin-top: 10px
    }

    .welcome .layuimini-qiuck-module a i {
        display: inline-block;
        width: 100%;
        height: 60px;
        line-height: 60px;
        text-align: center;
        border-radius: 2px;
        font-size: 30px;
        background-color: #F8F8F8;
        color: #333;
        transition: all .3s;
        -webkit-transition: all .3s;
    }

    .welcome .layuimini-qiuck-module a cite {
        position: relative;
        top: 2px;
        display: block;
        color: #666;
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
        font-size: 14px;
    }

    .welcome .welcome-module {
        width: 100%;
        height: 210px;
    }

    .welcome .panel {
        background-color: #fff;
        border: 1px solid transparent;
        border-radius: 3px;
        -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, .05);
        box-shadow: 0 1px 1px rgba(0, 0, 0, .05)
    }

    .welcome .panel-body {
        padding: 10px
    }

    .welcome .panel-title {
        margin-top: 0;
        margin-bottom: 0;
        font-size: 12px;
        color: inherit
    }

    .welcome .label {
        display: inline;
        padding: .2em .6em .3em;
        font-size: 75%;
        font-weight: 700;
        line-height: 1;
        color: #fff;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: .25em;
        margin-top: .3em;
    }

    .welcome .layui-red {
        color: red
    }

    .welcome .main_btn>p {
        height: 40px;
    }

    .welcome .layui-bg-number {
        background-color: #F8F8F8;
    }

    .welcome .layuimini-notice:hover {
        background: #f6f6f6;
    }

    .welcome .layuimini-notice {
        padding: 7px 16px;
        clear: both;
        font-size: 12px !important;
        cursor: pointer;
        position: relative;
        transition: background 0.2s ease-in-out;
    }

    .welcome .layuimini-notice-title,
    .layuimini-notice-label {
        padding-right: 70px !important;
        text-overflow: ellipsis !important;
        overflow: hidden !important;
        white-space: nowrap !important;
    }

    .welcome .layuimini-notice-title {
        line-height: 28px;
        font-size: 14px;
    }

    .welcome .layuimini-notice-extra {
        position: absolute;
        top: 50%;
        margin-top: -8px;
        right: 16px;
        display: inline-block;
        height: 16px;
        color: #999;
    }

    .welcome .image-container {
        margin-top: 20px;
        /* 调整图片与上边框的距离 */
        margin-left: 15px;
        /* 调整图片与左边框的距离 */
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .welcome .image-container img {
        width: 120px;
        /* 调整图片的宽度 */
        height: auto;
        /* 根据宽度自动调整高度 */
    }

    .welcome .image-caption {
        text-align: center;
        margin-top: 10px;
        /* 调整图片描述与图片之间的间距 */
        font-size: 14px;
        /* 调整图片描述的字体大小 */
        color: #333;
        /* 调整图片描述的字体颜色 */
    }

    .box {
        width: 250px;
        height: 40px;
        border: 2px solid rgb(1, 1, 22);
        margin: auto;
    }

    .input {
        float: left;
        width: 200px;
        /*宽400*/
        height: 38px;
        /*高38（因为文本框内外边框要占用1像素所以总体高度减2，其他盒子同理）*/
        outline: none;
        border: none;
        /*取消文本框内外边框*/
    }

    .button {
        float: left;
        width: 50px;
        height: 40px;
        color: white;
        background-color: rgb(49, 8, 122);
        /*将按钮背景设置为红色，字体设置为白*/
        border: none;
        outline: none;
        /*取消边框和外边框将按钮边框去掉*/
    }
</style>

<div class="layuimini-container layuimini-page-anim" id="container">
    <!-- 存放后端传输过来的前端代码的容器 -->
</div>

<script>
    function loadHTML() {
        var container = document.getElementById('container');
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'http://127.0.0.1:5000/user?user=' + localStorage.getItem('username'), true);
        xhr.onload = function () {
            if (xhr.status === 200) {
                container.innerHTML = xhr.responseText;
                drawEchart();
                drawSearchForm();
            }
        }
        xhr.send();
    }

    function drawEchart() {
        var username = localStorage.getItem('username');  // 获取用户名
        layui.use(['layer', 'echarts'], function () {
            console.log('33333')
            var $ = layui.jquery,
                layer = layui.layer,
                echarts = layui.echarts
            //echartsmy = layui.echartsmy;
            console.log('11111')
            /**
             * 查看公告信息
             **/
            $('body').on('click', '.layuimini-notice', function () {
                var title = $(this).children('.layuimini-notice-title').text(),
                    noticeTime = $(this).children('.layuimini-notice-extra').text(),
                    content = $(this).children('.layuimini-notice-content').html();
                var html = '<div style="padding:15px 20px; text-align:justify; line-height: 22px;border-bottom:1px solid #e2e2e2;background-color: #2f4056;color: #ffffff">\n' +
                    '<div style="text-align: center;margin-bottom: 20px;font-weight: bold;border-bottom:1px solid #718fb5;padding-bottom: 5px"><h4 class="text-danger">' + title + '</h4></div>\n' +
                    '<div style="font-size: 12px">' + content + '</div>\n' +
                    '</div>\n';
                parent.layer.open({
                    type: 1,
                    title: '数据统计' + '<span style="float: right;right: 1px;font-size: 12px;color: #b1b3b9;margin-top: 1px">' + noticeTime + '</span>',
                    area: '300px;',
                    shade: 0.8,
                    id: 'layuimini-notice',
                    btn: ['查看', '取消'],
                    btnAlign: 'c',
                    moveType: 1,
                    content: html,
                    success: function (layero) {
                        var btn = layero.find('.layui-layer-btn');
                        btn.find('.layui-layer-btn0').attr({
                            target: '_blank'
                        });
                    }
                });
            });


            var myChart = echarts.init(document.getElementById('echarts-relation'), 'walden');
            var network_file = username + `_network.json`
            var option;
            $.getJSON(
                network_file,
                function (json) {
                    option = {
                        animationDurationUpdate: 1500,
                        animationEasingUpdate: 'quinticInOut',
                        series: [
                            {
                                type: 'graph',
                                layout: 'none',
                                // progressiveThreshold: 700,
                                data: json.nodes.map(function (node) {
                                    return {
                                        x: node.x,
                                        y: node.y,
                                        id: node.id,
                                        name: node.label,
                                        symbolSize: node.size,
                                        itemStyle: {
                                            color: node.color
                                        }
                                    };
                                }),
                                edges: json.edges.map(function (edge) {
                                    return {
                                        source: edge.sourceID,
                                        target: edge.targetID
                                    };
                                }),
                                emphasis: {
                                    focus: 'adjacency',
                                    label: {
                                        position: 'right',
                                        show: true
                                    }
                                },
                                roam: true,
                                lineStyle: {
                                    width: 0.5,
                                    curveness: 0.3,
                                    opacity: 0.7
                                }
                            }
                        ]
                    }

                    console.log(option)
                    myChart.hideLoading();
                    myChart.setOption(
                        (option),
                        true
                    );
                }
            );

            //myChart.setOption(option);

            /**
             * 玫瑰图表
             */
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'http://127.0.0.1:5000/count?user=' + localStorage.getItem('username'), true);
            xhr.onload = function () {
                if (xhr.status === 200) {
                    var json = JSON.parse(xhr.responseText);
                    const echartsPies = echarts.init(document.getElementById('echarts-pies'), 'walden');

                    const optionPies = {
                        title: {
                            text: '信息类型',
                            left: 'center',
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: '{a} <br/>{b} : {c} ({d}%)',
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'left',
                            data: json.data.map((item) => item.name),
                        },
                        series: [
                            {
                                name: '信息类型',
                                type: 'pie',
                                radius: '55%',
                                center: ['50%', '60%'],
                                roseType: 'radius',
                                data: json.data,
                                emphasis: {
                                    itemStyle: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)',
                                    },
                                },
                            },
                        ],
                    };
                    echartsPies.setOption(optionPies);
                }
            }
            xhr.send();
        });
    };

    function drawSearchForm() {
        const form = document.querySelector('form');//form是格式<form></form>
        const nameResult = document.querySelector('#name')//剩下的都是id
        const text_in = document.querySelector('#text-in');
        const graph_in = document.querySelector('#graph-in');
        const society_in = document.querySelector('#society-in');
        //nameResult、text_in、graph_in、society_in是上面几个div的象征，要往里面插入内容
        const searchResult = document.querySelector('#search-result');
        //这个是包含以上4个的大div
        const textCheckbox = document.querySelector('#是否选择文本');
        const graphCheckbox = document.querySelector('#是否选择图像');
        const societyCheckbox = document.querySelector('#是否选择社交网络');
        //三个checkbox的结果，其中的.checked就是值（true/false）

        form.addEventListener('submit', function (event) {
            event.preventDefault();
            // 搜索框中输入的内容，在我们这里就是用户名
            localStorage.setItem('username', document.querySelector('#search').value);
            location.reload();
        });
    }

    loadHTML();

    // layui.use('jquery', function () {
    //     var $ = layui.jquery;
    //     // jQuery.support.cors = true;
    //     $.get("http://127.0.0.1:5000/user",
    //         { user: localStorage.getItem('username') },
    //         function (response) {
    //             $('#container').html(response)
    //         }
    //     );
    // });
</script>

<script>
    //import * as echarts1 from 'node_modules/echarts';

</script>
<script>

</script>